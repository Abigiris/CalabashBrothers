# 概述

### 情节描述

在二维空间的”战场“上，所有生物各自占据一个“位置”，总共分为“正”“反”两个阵营，列队在战场两侧。

正方：包括葫芦娃七兄弟和爷爷，大本营在战场左侧。战斗开始前，葫芦娃按照排行列队成一字长蛇阵，与爷爷一起站在左侧的大本营内。

反方：包括蝎子精、蛇精和若干小喽啰，大本营在战场右侧。战斗开始前，小喽啰们列队成某种阵型（如衡轭阵），与蝎子精和蛇精一起站在右侧的大本营内。

战斗开始后，两方生物相向进发，每个个体可以较为随意地选择下一步的方向。但是，在自己的大本营内时不可后退，深入到敌方大本营后不再前进，最终保证双方在战场的中间地带快速结束战斗。

两个生物“接触”时会进行打斗，某一方会阵亡。当一方生物全部阵亡时，战斗结束。

### 操作说明

键盘控制各种事件的发生

SPACE： 战斗开始，双方生物自动战斗

S：保存刚结束的战斗记录至外部文件中

L：选择读取外部文件，回放文件中的内容

C：清理战场，清空所有生物

R：重新开始



# 设计

### 面向对象

本应用采用面向对象编程方法，主要包括“战场”、“生物”、“阵型”、“记录仪”等类进行具体的实现。

战场：应用的主体，包含各种生物，可以进行队形的变换等行为。

生物：派生出葫芦娃、爷爷、小喽啰等具体的生物类，拥有生物的属性以及“移动”等行为。每个生物在实现时具有自己的线程。

阵型：用于改变战场上生物的位置。

记录仪：记录战斗过程中每个生物在不同时间的状态，以及将记录以线程形式回放。记录仪要能跟外部文件进行交互。



# 实现

### 源码

#### main

类Main继承了Application，为GUI进行初始化。新建了一个“战场”map，将其映射到scene中，并且通过scene.setOnKeyPressed，处理各种键盘事件。

#### map

Position类作为一个”位置“，拥有坐标的特性，利用泛型表示其上可以站立一个生物。

Map类包含各种生物、一个记录仪以及GUI界面的相关参数。通过initMap()、clearMap()等实现战场状态的改变，并管理生物的线程等数据成员；battle()使得各个生物的线程start()，开始战斗；replay()会调用记录仪的相关内容，进行回放；printMap()改变scene上的组件，将战场内容在GUI上表示。

#### creature

Creature类作为基类，实现了Runnable，拥有name、id等属性，可以有move()、kill()等行为。其run()的内容是实现autoMove()，在战场上移动和战斗，并更新map的显示。

葫芦娃个体在CalabashBody类中实现，七个葫芦娃利用集合类型ArrayList组成CalabashBrother类，进行排序。爷爷和蛇精额外实现“加油”的接口cheer。蝎子精有“领导”的额外行为。小喽啰简单继承了Creature。

#### formation

利用接口“form”"loose"进行“列队”和“解散”，各个队形都是在map上移动一组creature。

#### record

Record类记录一条信息，分为“CREATE”"MOVE""DIE"三类。每条信息记录了一个生物的id、信息的类型、发生的时间、发生的位置等内容。

RecordPlayer类实现了一个记录仪的功能，含有一个record的列表，run中即回放列表中的内容。记录仪还可以通过readRecordFile()、writeRecordFile()进行记录文件的读写。

### 异常处理

主要对“在已有生物的位置上再次放置其他生物”抛出异常。

### 测试

主要对乱序葫芦娃的排序进行测试。